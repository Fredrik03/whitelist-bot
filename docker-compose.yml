version: '3.8'

services:
  whitelist-bot:
    image: ghcr.io/fredrik03/whitelist-bot:latest
    container_name: whitelist-bot
    restart: unless-stopped
    volumes:
      - /mnt/user/appdata/whitelist-bot/data:/data
    environment:
      - TZ=Europe/Oslo
      - DB_PATH=/data/whitelist.db
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - DISCORD_CLIENT_ID=${DISCORD_CLIENT_ID}
      - DISCORD_CHANNEL_ID=${DISCORD_CHANNEL_ID}
      - DISCORD_STATUS_CHANNEL_ID=${DISCORD_STATUS_CHANNEL_ID}
      - PTERODACTYL_URL=${PTERODACTYL_URL}
      - PTERODACTYL_SERVER_ID=${PTERODACTYL_SERVER_ID}
      - PTERODACTYL_API_KEY=${PTERODACTYL_API_KEY}
      - MINECRAFT_SERVER_HOST=${MINECRAFT_SERVER_HOST}
      - MINECRAFT_SERVER_PORT=${MINECRAFT_SERVER_PORT}
    networks:
      - bot-network
    healthcheck:
      test: ["CMD", "node", "-e", "const {Client,GatewayIntentBits}=require('discord.js');const c=new Client({intents:[GatewayIntentBits.Guilds]});c.on('ready',()=>{console.log('healthy');process.exit(0)});c.login(process.env.DISCORD_TOKEN).catch(()=>process.exit(1));setTimeout(()=>process.exit(1),5000);"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  bot-network:
    driver: bridge
